### 이더리움

------

**이더리움이란?**

* 공개형 블록체인(Public, Permissionless blockchain)

  * 2014년 crowd sale 실시
  * 2015년 6월 동작 실시

* 분산 어플리케이션을 위한 플랫폼을 표방

* Blockchain 20

  * 비트코인(Bitcoin)의 scripting language를 개선, 발전시킨 스마트 컨트랙트

  * 이후 등장한 블록체인들이 스마트 컨트랙트를 핵심요소로 가지게 됨

* 이더(Ether, ETH)

  * 이더리움에서 발행한 암호화폐
  * 거래(Transaction), 스마트 컨트랙트 비용(Gas) 지불 등 이더리움이 동작

  

**분산화된 상태전이 머신**

* 트랜잭션에 기반한 상태전이
  * 단, 이전 상태로 되돌아갈 수 없음
* 암호화 알고리즘을 활용 -> 무작위로 상태전이가 일어나는 것을 방지
* 모든 참여자가 동일한 상태를 공유
* 블록은 해당 시점의 이더리움의 상태를 나타낸다고 볼 수 잇음
  * 현재 블록 -> 현재 이더리움의 상태



**이더리움 계정의 종류**

* 외부 소유 계정(EOA, External Owned Account)
  * ETH 잔액 유지
  * 개인 키를 통한 주소 관리
  * ETH 전송, 컨트랜트 실행을 위한 거래 전송 가능
  * 컨트랙트 코드를 가지고 있지 않음(빈 문자열 hash값)
* 컨트랙트 계정(CA, Contract Account)
  * ETH 잔액 유지
  * 주소를 가지고 있으나 개인키는 존재하지 않음
  * 컨트랙트 코드 보유
  * 거래나 메시지를 수신하면 보유하고 있는 컨트랙트 코드를  실행



**주소 생성**

1. 개인키 생성: 256bit의 무작위 숫자 -> 64자리의 Hex값으로 인코딩

2. 타원곡선전자서명 알고리즘(ECDSA, secp256k1)을 사용하여 공개키 생성
3. **Keccak-256 hashing**
4. 계정 주소



**상태(State)**

* 어느 한 시점에 대한 Ether의 잔액, 기타 정보를 담고 있는 계정(Account)들의 집함
* 모든 이더리움의 참여 노드는 로컬에 상태 정보를 유지함
* stateObject
  * 상태의 수정이 발생한 이더리움 계정을 나타내는 객체
  * 주요 데이터 (go-ethereum ~/ core/state/state_objectgo)
    * Address commonAddress -> 이더리움 주소
    * addHash common.hash -> 이더리움 주소의 hash 값
    * data Account -> 이더리움 계정
    * db*stateDB -> 상태를 저장할 DB
    * code Code -> 컨트랙트 코드
  * stateObject를 통해 이더리움의 state database인 LevelDB에 업데이트



**이더리움의 상태 전이(State Transition)**

* 블록 채굴로 인한 거래 내역 추가 시 상태 전이 발생
* 상태전이함수에 의해 수행
  * APPLY(S, TX) -> S' or Error



**트랜잭션(Transaction)**

* EOA가 다른 EOA 혹은 CA로 보내는 '**서명된 메시지**'
  * EOA -> EOA : ETH 잔액 변경(ETH송금)
  * EOA -> CA: 컨트랙트 코드 실행
* 계정의 상태 변화를 유도하는 일종의 트리거



**내부 트랜잭션(Internal Transaction)**

* CA가 다른 CA혹은 EOA에게 전달하는 '**서명되지 않은 메시지**'

* 주로 컨트랙트 함수 호출에 사용
* 블록체인에 별도로 저장되지 않음



**블록(Block)**

* 이더리움 장부에 기록되는 데이터의 기본 단위
* 트랜잭션들의 집합
* 주요 데이터(go-ethereum ~core/types/block.go)



**엉클 블록(Uncle Block)**

* 동일한 시점에 채굴된 블록 중 채굴 난이도가 낮아 메인 체인에 연결되지 못한 블록
* 블록생성 시간이 빠를 수록 엉클 블록의 발생활률이 높음
  * 비트코인 -> 약 10분, 이더리움 -> 약 14초
* 문제점
  * 엉클 블록에 포함된 트랜잭션은 승인되지 않았기 때문에 트랜잭션 처리 지연 발생
  * 승인되지 않은 블록에 연산이 소모되어 연산량이 낭비됨
  * 평균 블록생성 시간이 늘어나 채굴 난이도가 감소하게 되어 네트워크 보안수준이 낮아짐



**작업증명(PoW, Proof of Work)**

* Ethash*
  * 비트코인의 PoW의 문제점(낮은 ASIC 저항성)을 개선
  * ASIC(Application Specific Integrated Circuit) 저항성을 높임
  * 계산은 어렵게, 검증은 쉽게

**지분증명(PoS, Proof of Stake)**

* 검증자가 가진 지분(Stake)에 비례한 확률로 블록 생성 권한을 획득하여 생성된 블록을 원한는 체인에 연결, 보상 획득
* PoW의 문제점을 개선
  * 전력 소모량, 채굴 중앙화 등
*  이더리움은 Casper를 통해 Pos로 전환 중